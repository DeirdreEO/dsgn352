<!--

#TODO: change the colors of the bars based on the neighborhood
#TODO: horizontally center the svg
TODO: increase the scale of the entire piece
TODO: move the bar labels next to the bars
TODO: rotate the labels 90 degrees (counter-clockwise)
TODO: create a margin; some labels are falling off the page
TODO: add the axes and their labels

-->


<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>assignment 06t_bar bar chart</title>
    <script type="text/javascript" src="d3.js"> </script>
    <style type="text/css">
    /*.axis path,
    .axis line {
      fill: none;
      stroke: black;
      shape-rendering: crispEdges;
    }

    .axis text {
      font-family: sans-serif;
      font-size: 11px;
    }*/

    .bar {
  fill: steelblue;
}

.bar:hover {
  fill: brown;
}

.axis {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {
  display: none;
}

        .canvas {
            display: block ;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>
  <h1>Boston Bar Ratings</h1>

  <script type="text/javascript">


        var svg_width = 800;
        var svg_height = 200;
        var barPadding = 1;

        var dataset;

        var svg = d3.select ("body")
          .append ("svg")
                .attr("class","canvas")
                .attr ("width", svg_width)
                .attr ("height", svg_height);

        d3.csv ( "bar_bar_chart.csv", function ( error, data ) {

            if ( error ) {
                // This displays an error message in console if the data fails to load.
                console.log ( "There was an error accessing your dataset." ) ;}
                else {

                // Assign the local variable 'data', which holds our CSV file info, to the global variable 'dataset'.
                dataset = data ;

                // tweak the scale here. woohoo!
                var bar_scale = 40 ;


                d3
                  .select ("svg")
                  .selectAll("rect")
          			  .data(dataset)
          			  .enter()
          			  .append("rect")
                  .attr("x", function(d, i) {
                    return i * (svg_width / dataset.length);
                  })
                  .attr("y", function(d) {
                    return svg_height - (d.Rating * bar_scale);
                  }) //Height minus data value
                  .attr("width", svg_width / dataset.length - barPadding)
                  .attr("height", function(d) {
                            return d.Rating * bar_scale ;
                  })
                  // .attr("class", "bar")
                  .attr("fill", function (d) {
                    if ( d.City == "Boston" ) {
                      return "blue";}
                    else {
                      return "orange";}
                    })

                    };

                  d3
                    .select("svg")
                    .selectAll("text")
          			   .data(dataset)
          			   .enter()
          			   .append("text")
          			   .text(function(d) {
          			   		return d.Name;
          			   })
                   .attr("text-anchor", "middle")
          			   .attr("x", function(d, i) {
          			   		return i * (svg_width / dataset.length) + (svg_width / dataset.length - barPadding) / 2;
          			   })
          			   .attr("y", function(d) {
          			   		return svg_height - (d.Rating * 10) + .5;
          			   })
          			   .attr("font-family", "sans-serif")
          			   .attr("font-size", "5px")
          			   .attr("fill", "black");
                  //  .attr("transform", "rotate(-90)");

               });

               //Define X axis
         			var xAxis = d3.svg.axis()
         							  .scale(xScale)
         							  .orient("bottom")
         							  .ticks(5)
         							  .tickFormat(formatAsPercentage);

         			//Define Y axis
         			var yAxis = d3.svg.axis()
         							  .scale(yScale)
         							  .orient("left")
         							  .ticks(5)
         							  .tickFormat(formatAsPercentage);

               //Create X axis
         			svg.append("g")
         				.attr("class", "axis")
         				.attr("transform", "translate(0," + (svg_height - barPadding) + ")")
         				.call(xAxis);

         			//Create Y axis
         			svg.append("g")
         				.attr("class", "axis")
         				.attr("transform", "translate(" + barPadding + ",0)")
         				.call(yAxis);

//     var margin = {top: 20, right: 20, bottom: 30, left: 40},
//     width = 960 - margin.left - margin.right,
//     height = 500 - margin.top - margin.bottom;
//
// var x = d3.scale.ordinal()
//     .rangeRoundBands([0, width], .1);
//
// var y = d3.scale.linear()
//     .range([height, 0]);
//
// var xAxis = d3.svg.axis()
//     .scale(x)
//     .orient("bottom");
//
// var yAxis = d3.svg.axis()
//     .scale(y)
//     .orient("left")
//     .ticks(10, "%");
//
// var svg = d3.select("body").append("svg")
//     .attr("width", width + margin.left + margin.right)
//     .attr("height", height + margin.top + margin.bottom)
//   .append("g")
//     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
//
// d3.tsv("bar_bar_chart.csv", type, function(error, data) {
//   if (error) throw error;
//
//   x.domain(data.map(function(d) { return d.Name; }));
//   y.domain([0, d3.max(data, function(d) { return d.Rating; })]);
//
//   svg.append("g")
//       .attr("class", "x axis")
//       .attr("transform", "translate(0," + height + ")")
//       .call(xAxis);
//
//   svg.append("g")
//       .attr("class", "y axis")
//       .call(yAxis)
//     .append("text")
//       .attr("transform", "rotate(-90)")
//       .attr("y", 6)
//       .attr("dy", ".71em")
//       .style("text-anchor", "end")
//       .text("Rating");
//
//   svg.selectAll(".bar")
//       .data(data)
//     .enter().append("rect")
//       .attr("class", "bar")
//       .attr("x", function(d) { return x(d.Name); })
//       .attr("width", x.rangeBand())
//       .attr("y", function(d) { return y(d.Rating); })
//       .attr("height", function(d) { return height - y(d.Rating); });
// });
//
// function type(d) {
//   d.Rating = +d.Rating;
//   return d;
// }
  </script>
</body>
</html>
